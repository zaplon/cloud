<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="CDA_PL_IG_1.3.1.xsl" type="text/xsl"?>
<ClinicalDocument xmlns="urn:hl7-org:v3" xmlns:extPL="http://www.csioz.gov.pl/xsd/extPL/r2" xmlns:pharm="urn:ihe:pharm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="extPL:ClinicalDocument">
	<typeId extension="POCD_HD000040" root="2.16.840.1.113883.1.3"/>
	<templateId root="1.3.6.1.4.1.19376.1.9.1.1.1"/>
    <templateId root="1.3.6.1.4.1.19376.1.5.3.1.1.1"/>
    <templateId root="2.16.840.1.113883.3.4424.13.10.1.14" extension="1.3.1"/>
    <id extension="{{ numer_anulowania }}" root="{{ profile.id_podmiotu_lokalne }}.2.9" displayable="true"/>
	<code code="51851-4" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC" displayName="Administrative note">
	    <translation code="08.80" codeSystem="2.16.840.1.113883.3.4424.11.1.32" codeSystemName="KLAS_DOK_P1" displayName="Dokument anulujący"/>
	</code>
	<title>Dokument anulujący</title>
	<effectiveTime value="{{ recepta.data_wystawienia }}"/>
	<confidentialityCode code="N" codeSystem="2.16.840.1.113883.5.25"/>
	<languageCode code="pl-PL"/>
	<setId extension="432231" root="2.16.840.1.113883.3.4424.7.2.2"/>
	<versionNumber value="2"/>
	<recordTarget>
        <templateId root="2.16.840.1.113883.3.4424.13.10.2.3"/>
        <patientRole>
            <id extension="12345" root="2.16.840.1.113883.3.4424.2.7.0.17.1" displayable="false"/>
            <id extension="{{pacjent.pesel}}" root="2.16.840.1.113883.3.4424.1.1.616" displayable="true"/>
            <addr>
                <city>{{pacjent.miasto}}</city>
                <postalCode>{{pacjent.kod_pocztowy}}</postalCode>
                <streetName>{{pacjent.ulica}}</streetName>
                <houseNumber>{{pacjent.numer_ulicy}}</houseNumber>
                <unitID>{{pacjent.numer_lokalu}}</unitID>
            </addr>
            <patient>
                <name>
                    <given>{{ pacjent.imie }}</given>
                    <given>{{ pacjent_drugie_imie }}</given>
                    <family>{{ pacjent.nazwisko }}</family>
                </name>
                <administrativeGenderCode code="{{ pacjent.plec }}" codeSystem="2.16.840.1.113883.5.1"/>
                {% if pacjent.data_urodzenia %}
                <birthTime value="{{ pacjent.data_urodzenia }}"/>
                {% endif %}
            </patient>
        </patientRole>
    </recordTarget>
    <author>
        <templateId root="2.16.840.1.113883.3.4424.13.10.2.4"/>
        <functionCode code="LEK" codeSystem="2.16.840.1.113883.3.4424.11.3.18" displayName="pracownik"/>
        <time value="{{ recepta.data_anulowania }}"/>
        <assignedAuthor>
            <id extension="{{ profile.id_pracownika_oid_ext }}" root="2.16.840.1.113883.3.4424.1.6.2" displayable="true"/>
            <code code="0718" codeSystem="2.16.840.1.113883.3.4424.11.3.3.1" displayName="neurologia"/>
            <assignedPerson>
                <templateId root="2.16.840.1.113883.3.4424.13.10.2.1"/>
                <name>
                    <prefix>lek.</prefix>
                    <given>{{ pracownik.imie }}</given>
                    <family>{{ pracownik.nazwisko }}</family>
                </name>
            </assignedPerson>
            {% if profile.typ_podmiotu == 'PRAKTYKA_LEKARSKA' %}
            {% include 'parts/praktyka_lekarska/represented_organization.xml' %}
            {% elif profile.typ_podmiotu == 'PODMIOT_LECZNICZY' %}
            {% include 'parts/podmiot_leczniczy/represented_organization.xml' %}
            {% endif %}
        </assignedAuthor>
    </author>
    <custodian>
        <templateId root="2.16.840.1.113883.3.4424.13.10.2.5"/>
        <assignedCustodian>
            <representedCustodianOrganization>
                <id root="2.16.840.1.113883.3.4424" assigningAuthorityName="CSIOZ" displayable="false"/>
            </representedCustodianOrganization>
        </assignedCustodian>
    </custodian>
    <legalAuthenticator>
        <templateId root="2.16.840.1.113883.3.4424.13.10.2.6"/>
        <time value="{{ recepta.data_anulowania }}"/>
        <signatureCode code="S"/>
        <assignedEntity>
            <id extension="{{ profile.id_pracownika_oid_ext }}" root="2.16.840.1.113883.3.4424.1.6.2" displayable="false"/>
            <code code="LEK" codeSystem="2.16.840.1.113883.3.4424.11.3.18" displayName="pracownik"/>
        </assignedEntity>
    </legalAuthenticator>
	<participant typeCode="IND">
        <templateId root="2.16.840.1.113883.3.4424.13.10.2.19"/>
        <associatedEntity classCode="UNDWRT">
            <id extension="07" root="2.16.840.1.113883.3.4424.3.1" displayable="true"/>
        </associatedEntity>
    </participant>
	<relatedDocument typeCode="RPLC">
		<templateId root="2.16.840.1.113883.3.4424.13.10.2.46" />
	    <parentDocument>
		<!-- poniższe @@ to powiązania do recepty ktorej dotyczy dokument anulowania @@ -->
	        <id extension="{{recepta.numer}}" root="{{podmiot.id_lokalne}}.2.1" displayable="false"/>
	        <setId extension="432231" root="2.16.840.1.113883.3.4424.7.2.2"/>
			<!-- musi być mniejszy od numer wersji dokumentu anulowania -->
	        <versionNumber value="1"/>
	    </parentDocument>
	</relatedDocument>
	<component>
		<templateId root="2.16.840.1.113883.3.4424.13.10.2.47" />
	    <structuredBody>
	        <component>
	            <section>
	            	<templateId root="2.16.840.1.113883.3.4424.13.10.3.27" />
					<title>Dane dokumentu anulowanego</title>
	                <text>
	                    <paragraph>Proszę o anulowanie dokumentu:</paragraph>
	                    <paragraph><caption>Tytuł:</caption> Recepta</paragraph>
	                    <paragraph><caption>Data wystawienia:</caption>{{ recepta.data_wystawienia }}</paragraph>
	                    <paragraph><caption>Identyfikator:</caption>{{ recepta.external_id }}</paragraph>
	                </text>
	            </section>
	        </component>
	    </structuredBody>
	</component>
</ClinicalDocument>
